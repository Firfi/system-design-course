# Диаграмма Системы (PDF)

[Диаграмма Системы](graph.pdf)

#  Опишите, почему были выбраны именно такие части системы, которые вы выбрали

## Модуль матчинга

- Очень часто меняется
- Нужен отличный аудит (мы должны показать, что возникшие проблемы вызваны разработчиками алгоритма, а не нами)
- Потенциально очень медленный, нужен асинхронный интерфейс (выбрано что-то наподобие idempotency key)
- Очень нестандартная модель исполнения (вызов множества entry points "чёрного ящика")

## Деньги

- Фактически immutable база данных для аккаунтинга
- Нужно много оптимизированных views для фронтендов
- Точность критична
- Хорошо изолируем: слеп ко всему кроме своих "книг"

## Инвойсы

- Инвойс мутабельная сущность, пока не закрыт
- Недельный "набор знаний" для исполнения "один раз"
- Точность довольно критична

## Скидки

- Хорошо изолируемая функция от (total, discount logic)
- Где discount logic можно хранить исторично как данные

## Ставки

- Минимальные требования к надёжности
- Остальные системы про него знать не должны, для них эта информация будем мусором

## Нотификации

- Изолирует много общей логики, которая бы засорила другие системы
- Например, может знать про "важность" нотификаций, и лоад балансить нотификации от Лендинга Воркеров отдельно от остальных, чтобы DDoS не убил все нотификации случайно

## Заявки

- Изолирует много связанной с HR бизнес логики
- Требование DDoS устойчивости (для части заявок)

## Ассессмент

- Тестирование и Качество очень похожие по назначению данные
- Хорошо изолируем
- Изолирует собой базу заявок

## Заказы

- Требование - достоверная история заказа на любой момент времени
- Удобно иметь event sourcing и стрим этих ивентов, чтобы модуль не знал о других модулях
- Машина состояний, структура которой возможно будет меняться
- Модуль Провалов может лежать рядом (и там требование поллинг/очередь в базе)

## Склад

- Сильно асинхронный
- Хорошо изолируется через очереди сообщений
- Может лежать вместе с Печеньями, они взаимодействуют через физическую доставку как минимум

## Юзеры

- Из просто все читают
- Аутентикация + мета данные, для удобства храним вместе но помним что это разные требования

# Опишите, почему была выбрана именно такая структура (монолит, сервисы или микс)

## Матчинг - сервис

- Никто не знает, какой там треш происходит, может Алгоритм работает долго и никогда не завершится, накопятся запросы
- Можно звать по HTTP, всё равно от медленный

## Лендинг Воркеров - сервис + UI

- Его ддосят

## Менеджмент - сервис + UI

- Очень малая нагрузка
- Можно поселить в нём несколько Модулей с небольшой нагрузкой - Ставки (можно использовать общую бд, покуда другим Модули не знают про Ставки), Ассессмент (при условии, что интерфейс Тестов для Кандидатов будет внешним сервисом)
- Меньшие требования к юзабилити на фронтенде (vs. Клиент и Воркер)

## Клиент, Воркер, Заказы, Юзеры, Инвойсы, Деньги,   - макросервис + UI

- В сервисы пихнуть всегда успеем (не забываем поддерживать эти сущности хорошо разделёнными)
- Деньги и Инвойсы очень транзакционные, им хорошо лежать вместе


## Склад + UI

- Сильно другая система, другие люди, другие сущности
- Взаимодействие с основной системой минимальное

# Опишите, почему были выбраны именно такие коммуникации (если это не один большой монолит)

## Матчинг

HTTP, для простоты (можно и очереди, результат тот же), но с idempotency

## База Юзеров

- Прямой (или Views) readonly доступ системам к базам User Profiles: будет много чтений "дай мне юзера"
- Auth пока нужен только монолиту Клиент/Воркер

## Заказы

- Стримы для изоляции логики; Заказы должны много кого информировать о своём статусе
- Склад - не хотим терять нотификации от склада если Заказы лежат

##  Остальное

- HTTP API как решение по-умолчанию

# Описать спорные места и (или) места, которые вам кажутся критичными на данный момент

## Чёрная Коробка Алгоритма

- мало специфики по природе Шагов, много assumptions с моей стороны

## Склад и Печенья

- assumption: они взаимодействуют сами по городскому телефону

## Создание клиентов US-010

- "автоматически?"

## Ставки

- предположение что менеджеры платят друг другу наличкой и сами ведут бух учёт этих денег в тетради

## Что такое TTM

Что такое TTM?
